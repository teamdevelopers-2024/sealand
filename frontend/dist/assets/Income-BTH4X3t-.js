import{j as e,r as d}from"./index-CaNYvZfv.js";import{a as V,b as T,s as $}from"./index-N7DkbhFS.js";import{E as z,i as B,d as q,C as U,L as G,a as Q,b as K,P as Z,p as H,c as J,e as X,f as ee}from"./PDFDownloadModal-C8S3D_gy.js";import{a as R}from"./api-yu6R-Exe.js";import te from"./Navbar-DoCceWHM.js";const ae=({entry:l,onClose:m})=>{const p=a=>{const o=new Date(a),g=String(o.getDate()).padStart(2,"0"),i=String(o.getMonth()+1).padStart(2,"0"),h=o.getFullYear();return`${g}-${i}-${h}`},b=()=>{const a=new z;a.setFillColor(0,0,0),a.rect(0,0,a.internal.pageSize.getWidth(),35,"F"),a.addImage(B,"PNG",10,10,50,20),a.setTextColor(255,255,255),a.setFontSize(12),a.text("Sea Land Car Care",160,20),a.text("Oorakam Karimbily, Vengara",150,25),a.text("Phone: +91 92071 50011",155,30),a.setTextColor(0,0,0),a.line(10,35,200,35),a.setFontSize(10),a.text(`Service Date: ${new Date(l.workDate).toLocaleDateString()}`,10,50),a.text(`Reciept Date: ${p(new Date)}`,160,50),a.setFontSize(12),a.text(`Customer: ${l.customerName}`,10,60),a.text(`Phone: ${l.contactNumber}`,10,70),a.text(`Vehicle Number: ${l.vehicleNumber}`,140,70),a.line(10,75,200,75),a.setFontSize(12),a.setFont("bold"),a.text("No.",10,82),a.text("Description",40,82),a.text("Reference",100,82),a.text("Amount",160,82),a.line(10,85,200,85),a.setFont("normal"),l.workDescriptions.forEach((g,i)=>{const h=90+i*10;a.text(`${i+1}`,10,h),a.text(`${g.description}`,40,h),a.text(`${g.reference}`,100,h),a.text(`${parseFloat(g.amount).toLocaleString()}`,160,h)});const o=90+l.workDescriptions.length*10;a.line(10,o+5,200,o+5),a.setFont("bold"),a.text("Total:",140,o+15),a.text(`${parseFloat(l.totalServiceCost).toLocaleString()}`,160,o+15),a.line(10,o+20,200,o+20),a.setFont("normal"),a.text("Thank you for your visit!",70,o+30),a.text("Visit us again!",80,o+35),a.save(`${l.customerName.replace(/[^a-zA-Z0-9]/g,"_")}_receipt.pdf`)};return l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-20"}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-30",children:e.jsxs("div",{className:"bg-gray-800 text-white rounded-lg shadow-lg p-6 w-full max-w-4xl mx-auto",children:[e.jsx("h2",{className:"text-xl mb-4",children:"Income Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-white block",children:"Work Date:"}),e.jsx("p",{className:"text-gray-300",children:new Date(l.workDate).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white block",children:"Customer Name:"}),e.jsx("p",{className:"text-gray-300",children:l.customerName})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white block",children:"Vehicle Number:"}),e.jsx("p",{className:"text-gray-300",children:l.vehicleNumber})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white block",children:"Contact Number:"}),e.jsx("p",{className:"text-gray-300",children:l.contactNumber})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white block",children:"Payment Method:"}),e.jsx("p",{className:"text-gray-300",children:l.paymentMethod})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white block",children:"Total Service Cost:"}),e.jsxs("p",{className:"text-gray-300",children:["₹ ",parseFloat(l.totalServiceCost).toLocaleString()]})]})]}),e.jsx("h3",{className:"text-lg mb-4",children:"Work Descriptions"}),e.jsxs("table",{className:"w-full mb-4",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center",children:"#"}),e.jsx("th",{className:"text-center",children:"Work Description"}),e.jsx("th",{className:"text-center",children:"Amount"}),e.jsx("th",{className:"text-center",children:"Reference"})]})}),e.jsx("tbody",{children:l.workDescriptions.map((a,o)=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-center",children:o+1}),e.jsx("td",{className:"text-center",children:a.description}),e.jsxs("td",{className:"text-center",children:["₹ ",parseFloat(a.amount).toLocaleString()]}),e.jsx("td",{className:"text-center",children:a.reference})]},o))})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{onClick:()=>b(),className:"bg-blue-600 text-white px-4 py-2 rounded",children:"Download PDF"}),e.jsx("button",{onClick:()=>m(),className:"bg-gray-600 text-white px-4 py-2 rounded",children:"Close"})]})]})})]}):null},se=({setIsModalOpen:l})=>{const[m,p]=d.useState(!1);return m?e.jsxs("button",{className:"mt-10 cursor-pointer border border-cyan-600 bg-opacity-20 bg-cyan-600 text-white font-semibold py-2 px-3 rounded-lg shadow-md hover:bg-cyan-600 transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 flex",onMouseLeave:()=>p(!1),onClick:()=>l(!0),children:["Download",e.jsx("div",{className:`ml-2 w-6 h-6 transition-opacity duration-300 ${m?"opacity-100":"opacity-0"}`,children:e.jsx("img",{src:q,alt:"Download Icon"})})]}):e.jsx("button",{className:"cursor-pointer border border-cyan-600 bg-opacity-20 bg-cyan-600 text-white font-semibold py-2 px-3 rounded-lg shadow-md hover:bg-cyan-600 transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 flex",onMouseEnter:()=>p(!0),children:"Download"})};U.register(G,Q,K,Z,H,J);function ne({incomeHistoryData:l,setIsModalOpen:m}){const p=new Date,b=p.getMonth(),a=p.getFullYear(),[o,g]=d.useState("Monthly"),[i,h]=d.useState(a),[f,I]=d.useState(0),[F,M]=d.useState(0);d.useEffect(()=>{const c=l.reduce((t,s)=>{const n=s.totalServiceCost;return t+n},0);I(c),M((()=>{if(o==="Monthly")return l.reduce((t,s)=>{const n=new Date(s.workDate);return n.getMonth()===b&&n.getFullYear()===i?t+s.totalServiceCost:t},0);if(o==="Daily"){const t=new Date;return l.reduce((s,n)=>{const u=new Date(n.workDate),v=Math.floor((t-u)/(1e3*60*60*24));return v>=0&&v<7?s+n.totalServiceCost:s},0)}else if(o==="Yearly")return l.reduce((t,s)=>new Date(s.workDate).getFullYear()===i?t+s.totalServiceCost:t,0);return 0})())},[l,o,b,i]);const P=c=>{g(c.target.value),c.target.value!=="Monthly"&&h(new Date().getFullYear())},y=o==="Monthly"?(()=>{const c=Array(12).fill(0);return l.filter(t=>new Date(t.workDate).getFullYear()===i).forEach(t=>{const n=new Date(t.workDate).getMonth();c[n]+=t.totalServiceCost||0}),c.map((t,s)=>({name:new Date(0,s).toLocaleString("default",{month:"short"}),income:t}))})():o==="Daily"?(()=>{const c=new Date,r=Array(7).fill(0),t=[];for(let s=6;s>=0;s--){const n=new Date(c);n.setDate(c.getDate()-s);const u=n.toLocaleString("default",{weekday:"short"});t.push(u)}return l.forEach(s=>{const n=new Date(s.workDate),u=Math.floor((c-n)/(1e3*60*60*24));u>=0&&u<7&&(r[6-u]+=s.totalServiceCost||0)}),t.map((s,n)=>({name:s,income:r[n]}))})():(()=>{const c=Array(5).fill(0),r=[];for(let t=0;t<5;t++){const s=i-4+t;r.push(s)}return l.forEach(t=>{const n=new Date(t.workDate).getFullYear()-(i-4);n>=0&&n<5&&(c[n]+=t.totalServiceCost||0)}),r.map((t,s)=>({name:t,income:c[s]}))})(),w=y.map(c=>c.name),E=y.map(c=>c.income),S={labels:w,datasets:[{label:"Income",data:E,borderColor:"#00d8ff",backgroundColor:"rgba(0, 216, 255, 0.2)",tension:.3,fill:!0}]},D=()=>{i>new Date().getFullYear()-5&&h(c=>c-1)},N=()=>{i<new Date().getFullYear()&&h(c=>c+1)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"bg-gray-800 p-8 rounded-xl flex justify-between items-center mb-8",children:[e.jsxs("div",{className:"text-left space-y-3 w-1/3",children:[e.jsx("h2",{className:"text-5xl font-bold text-cyan-400",children:"Total income"}),e.jsx("h3",{className:"text-3xl text-green-300 font-bold",children:new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(f)}),e.jsx("p",{className:"text-gray-500",children:new Date().toLocaleDateString()}),e.jsxs("h2",{className:"text-3xl font-bold text-cyan-400",children:[o," income"]}),e.jsx("h3",{className:"text-3xl text-green-300 font-bold",children:new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(F)}),e.jsx(se,{setIsModalOpen:m})]}),e.jsxs("div",{className:"w-2/4 relative",children:[e.jsx("div",{className:"absolute z-10 bottom--4 left-0 p-2",children:e.jsx("div",{className:"bg-gray-700 px-1.5 py-1.5 rounded-full text-cyan-500",children:e.jsxs("select",{value:o,onChange:P,className:"cursor-pointer bg-gray-700 rounded-full text-cyan-500 outline-none",children:[e.jsx("option",{value:"Daily",children:"Daily"}),e.jsx("option",{value:"Monthly",children:"Monthly"}),e.jsx("option",{value:"Yearly",children:"Yearly"})]})})}),e.jsxs("div",{className:"mt-5",style:{width:"100%",height:"300px",marginBottom:"45px"},children:[e.jsx("div",{className:"flex justify-center mb-2 text-gray-300",children:o==="Daily"?e.jsx("span",{className:"text-lg font-semibold",children:"Last 7 Days"}):o==="Monthly"?e.jsx("span",{className:"text-lg font-semibold",children:i}):e.jsx("span",{className:"text-lg font-semibold",children:"Last 5 Years"})}),o==="Monthly"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute left-0 top-1/2 transform -translate-y-1/2 p-2 bg-gray-700 rounded-full text-cyan-400 hover:bg-gray-600 transition",style:{marginLeft:"-8%",width:"6%",height:"10%",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("button",{onClick:D,className:"text-cyan-400",children:e.jsx(V,{})})}),e.jsx("div",{className:"absolute right-0 top-1/2 transform -translate-y-1/2 p-2 bg-gray-700 rounded-full text-cyan-400 hover:bg-gray-600 transition",style:{marginRight:"1%",width:"6%",height:"10%",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("button",{onClick:N,className:"text-cyan-400",children:e.jsx(T,{})})})]}),e.jsx(X,{data:S,options:{responsive:!0,plugins:{legend:{display:!1},tooltip:{backgroundColor:"#333",titleColor:"#fff",bodyColor:"#fff"}},scales:{x:{grid:{display:!1},ticks:{color:"#999"}},y:{display:!1,grid:{display:!1}}}}})]})]})]})})}const re=({addIncomeModal:l})=>{const[m,p]=d.useState([]),[b,a]=d.useState(!1),[o,g]=d.useState({}),[i,h]=d.useState(1),[f,I]=d.useState(""),[F,M]=d.useState(null),[P,C]=d.useState(null),[L,x]=d.useState(!1),y=5;d.useEffect(()=>{l||(async()=>{try{const n=(await R.showIncome()).data.sort((u,v)=>new Date(v.workDate)-new Date(u.workDate));p(n),console.log(n)}catch(s){console.error("Error fetching income history data",s)}})()},[l]);const w=()=>{let t=m;if(f){const s=f.toLowerCase();t=t.filter(n=>n.customerName.toLowerCase().includes(s)||n.contactNumber.toString().includes(s))}return t},E=(t,s)=>{const n=new z;n.setFontSize(12);const u=["Date","Customer Name","Vehicle Number","Phone Number","Amount"],v=m.filter(j=>{const k=new Date(j.workDate);return k>=t&&k<=s});n.text("Income History",100,10),u.forEach((j,k)=>n.text(j,14+k*40,25)),n.line(10,28,200,28);let A=0;v.forEach((j,k)=>{const W=[new Date(j.workDate).toLocaleDateString("en-GB"),j.customerName,j.vehicleNumber,j.contactNumber?j.contactNumber.toString():"",` ${j.totalServiceCost}`];A+=j.totalServiceCost,W.forEach((O,_)=>{n.text(O.toString(),14+_*40,35+k*10)})});const Y=35+v.length*10;n.line(10,Y,200,Y),n.text(`Total Income:  ${A}`,150,Y+10),n.save("income_history.pdf")},S=w(),D=S.length,N=Math.ceil(D/y),c=S.slice((i-1)*y,i*y),r=t=>{g(t),a(!0)};return e.jsxs("div",{className:"min-h-screen bg-gray-900 p-10 text-gray-100 relative",children:[e.jsxs("main",{className:"mt-8 p-2",children:[e.jsx(ne,{incomeHistoryData:m,setIsModalOpen:x}),e.jsxs("div",{className:"bg-gray-800 p-10 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-2xl font-bold text-cyan-400",children:"Income History"}),e.jsx("input",{type:"text",value:f,onChange:t=>I(t.target.value),placeholder:"Search by name or phone",className:"bg-gray-700 text-gray-100 px-4 py-2 rounded-lg"})]}),e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-gray-500",children:[e.jsx("th",{className:"pb-2",children:"Date"}),e.jsx("th",{className:"pb-2",children:"Customer name"}),e.jsx("th",{className:"pb-2",children:"Vehicle number"}),e.jsx("th",{className:"pb-2",children:"Payment type"}),e.jsx("th",{className:"pb-2",children:"Phone number"}),e.jsx("th",{className:"pb-2",children:"Amount"}),e.jsx("th",{className:"pb-2",children:"Receipt"})]})}),e.jsx("tbody",{children:c.length>0?c.map(t=>e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("td",{className:"py-2",children:new Date(t.workDate).toLocaleDateString("en-GB")}),e.jsx("td",{className:"py-2",children:t.customerName}),e.jsx("td",{className:"py-2",children:t.vehicleNumber}),e.jsx("td",{className:"py-2",children:t.paymentMethod}),e.jsx("td",{className:"py-2",children:t.contactNumber}),e.jsxs("td",{className:"py-2",children:["₹ ",t.totalServiceCost]}),e.jsx("td",{className:"py-2",children:e.jsx("button",{onClick:()=>r(t),className:"text-cyan-400",children:"View"})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"py-4 text-center text-gray-500",children:"No data available"})})})]}),N>1&&e.jsxs("div",{className:"flex justify-between mt-4",children:[e.jsx("button",{onClick:()=>h(t=>Math.max(t-1,1)),disabled:i===1,className:`text-cyan-400 ${i===1?"opacity-50 cursor-not-allowed":""}`,children:e.jsx(V,{})}),e.jsxs("span",{className:"text-gray-300",children:["Page ",i," of ",N]}),e.jsx("button",{onClick:()=>h(t=>Math.min(t+1,N)),disabled:i===N,className:`text-cyan-400 ${i===N?"opacity-50 cursor-not-allowed":""}`,children:e.jsx(T,{})})]}),b&&e.jsx(ae,{entry:o,onClose:()=>a(!1)})]})]}),e.jsx(ee,{isOpen:L,onClose:()=>x(!1),customStartDate:F,setCustomStartDate:M,customEndDate:P,setCustomEndDate:C,generatePDF:E})]})},le=({setAddIncomeModal:l})=>{const[m,p]=d.useState([{description:"",amount:"",reference:""}]),[b,a]=d.useState(""),[o,g]=d.useState(""),[i,h]=d.useState(""),[f,I]=d.useState("");d.useState(0);const F=new Date,M={timeZone:"Asia/Kolkata"},P=F.toLocaleDateString("en-CA",M),[C,L]=d.useState(P),[x,y]=d.useState({}),w=(r,t)=>{const{name:s,value:n}=t.target,u=[...m];u[r][s]=n,p(u)},E=()=>{p([...m,{description:"",amount:"",reference:""}])},S=r=>{const t=m.filter((s,n)=>n!==r);p(t)},D=()=>m.reduce((t,s)=>{const n=parseFloat(s.amount)||0;return t+n},0),N=()=>{let r={};return C||(r.workDate="Work date is required."),b||(r.customerName="Customer name is required."),o||(r.vehicleNumber="Vehicle number is required."),i||(r.contactNumber="Contact number is required."),f||(r.paymentMethod="Select a payment method."),D()<=0&&(r.totalServiceCost="Total cost must be greater than zero."),y(r),Object.keys(r).length===0},c=async()=>{if(!N())return;const r={workDate:C,customerName:b,vehicleNumber:o.toUpperCase(),contactNumber:i,paymentMethod:f,totalServiceCost:D(),workDescriptions:m};try{const t=await R.addIncome(r);if(t.error){$("Error!",t.errors[0],"error");return}$("Success!","Income added successfully!","success"),l(!1)}catch(t){console.error(t),$("Error!","Failed to add income.","error")}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-20"}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-30",children:e.jsxs("div",{className:"bg-gray-800 text-white rounded-lg shadow-lg p-6 w-full max-w-4xl mx-auto",children:[e.jsx("h2",{className:"text-xl mb-4",children:"Income Entry"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-white",children:"Work Date"}),e.jsx("input",{type:"date",className:"p-2 bg-gray-700 rounded w-full",value:C,onChange:r=>L(r.target.value)}),x.workDate&&e.jsx("p",{className:"text-red-500",children:x.workDate})]}),e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-white",children:"Customer Name"}),e.jsx("input",{type:"text",placeholder:"Who is the customer?",className:"p-2 bg-gray-700 rounded w-full",value:b,onChange:r=>a(r.target.value)}),x.customerName&&e.jsx("p",{className:"text-red-500",children:x.customerName})]}),e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-white",children:"Vehicle Number"}),e.jsx("input",{type:"text",placeholder:"Plate ID for this vehicle?",className:"p-2 bg-gray-700 rounded w-full",value:o.toUpperCase(),onChange:r=>g(r.target.value)}),x.vehicleNumber&&e.jsx("p",{className:"text-red-500",children:x.vehicleNumber})]}),e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-white",children:"Contact Number"}),e.jsx("input",{type:"tel",placeholder:"Preferred contact for updates?",className:"p-2 bg-gray-700 rounded w-full",value:i,onChange:r=>h(r.target.value)}),x.contactNumber&&e.jsx("p",{className:"text-red-500",children:x.contactNumber})]}),e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-white",children:"Payment Method"}),e.jsxs("select",{className:"p-2 bg-gray-700 rounded w-full",value:f,onChange:r=>I(r.target.value),children:[e.jsx("option",{value:"",children:"How did you pay?"}),e.jsx("option",{value:"Cash",children:"Cash"}),e.jsx("option",{value:"UPI",children:"UPI"}),e.jsx("option",{value:"Online Transfer",children:"Online Transfer"})]}),x.paymentMethod&&e.jsx("p",{className:"text-red-500",children:x.paymentMethod})]})]}),e.jsxs("table",{className:"w-full mb-4",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Work Description"}),e.jsx("th",{children:"Amount"}),e.jsx("th",{children:"Reference"}),m.length>1&&e.jsx("th",{children:"Action"})]})}),e.jsx("tbody",{children:m.map((r,t)=>e.jsxs("tr",{children:[e.jsx("td",{children:t+1}),e.jsx("td",{children:e.jsx("input",{type:"text",name:"description",value:r.description,onChange:s=>w(t,s),className:"p-2 bg-gray-700 rounded w-full",placeholder:"Name of the work"})}),e.jsx("td",{children:e.jsx("input",{type:"number",name:"amount",value:r.amount,onChange:s=>w(t,s),className:"p-2 bg-gray-700 rounded w-full",placeholder:"Amount of work"})}),e.jsx("td",{children:e.jsx("input",{type:"text",name:"reference",value:r.reference,onChange:s=>w(t,s),className:"p-2 bg-gray-700 rounded w-full",placeholder:"Additional information"})}),e.jsx("td",{children:t>0&&e.jsx("button",{className:"text-red-500",onClick:()=>S(t),children:"🗑"})})]},t))})]}),e.jsx("button",{onClick:E,className:"bg-teal-500 text-white px-4 py-2 rounded mb-4",children:"+ Add Field"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-lg font-semibold",children:["Total Amount: ₹ ",D().toLocaleString()]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{onClick:()=>l(!1),className:"bg-gray-600 text-white px-4 py-2 rounded",children:"Cancel"}),e.jsx("button",{onClick:c,className:"bg-teal-500 text-white px-4 py-2 rounded",children:"Save"})]})]})]})})]})},he=()=>{const[l,m]=d.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(te,{setAddIncomeModal:m}),e.jsx(re,{addIncomeModal:l}),l&&e.jsx(le,{setAddIncomeModal:m})]})};export{he as default};
