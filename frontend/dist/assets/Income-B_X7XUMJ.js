import{j as e,r as i}from"./index-DYEpRf3J.js";import{a as A,b as V,s as T}from"./index-1ADQcn2U.js";import{E as z,i as q,d as B,C as U,L as G,a as Q,b as K,P as Z,p as H,c as J,e as X,f as ee}from"./PDFDownloadModal-Bcku5HOH.js";import{a as R}from"./api-D-sRIgKl.js";import te from"./Navbar-C1Tc-Tdw.js";const ae=({entry:r,onClose:m})=>{const u=n=>{const l=new Date(n),p=String(l.getDate()).padStart(2,"0"),c=String(l.getMonth()+1).padStart(2,"0"),x=l.getFullYear();return`${p}-${c}-${x}`},N=()=>{const n=new z;n.setFillColor(0,0,0),n.rect(0,0,n.internal.pageSize.getWidth(),35,"F"),n.addImage(q,"PNG",10,10,50,20),n.setTextColor(255,255,255),n.setFontSize(12),n.text("Sea Land Car Care",160,20),n.text("Oorakam Karimbily, Vengara",150,25),n.text("Phone: +91 92071 50011",155,30),n.setTextColor(0,0,0),n.line(10,35,200,35),n.setFontSize(10),n.text(`Service Date: ${new Date(r.workDate).toLocaleDateString()}`,10,50),n.text(`Reciept Date: ${u(new Date)}`,160,50),n.setFontSize(12),n.text(`Customer: ${r.customerName}`,10,60),n.text(`Phone: ${r.contactNumber}`,10,70),n.text(`Vehicle Number: ${r.vehicleNumber}`,140,70),n.line(10,75,200,75),n.setFontSize(12),n.setFont("bold"),n.text("No.",10,82),n.text("Description",40,82),n.text("Reference",100,82),n.text("Amount",160,82),n.line(10,85,200,85),n.setFont("normal"),r.workDescriptions.forEach((p,c)=>{const x=90+c*10;n.text(`${c+1}`,10,x),n.text(`${p.description}`,40,x),n.text(`${p.reference}`,100,x),n.text(`${parseFloat(p.amount).toLocaleString()}`,160,x)});const l=90+r.workDescriptions.length*10;n.line(10,l+5,200,l+5),n.setFont("bold"),n.text("Total:",140,l+15),n.text(`${parseFloat(r.totalServiceCost).toLocaleString()}`,160,l+15),n.line(10,l+20,200,l+20),n.setFont("normal"),n.text("Thank you for your visit!",70,l+30),n.text("Visit us again!",80,l+35),n.save(`${r.customerName.replace(/[^a-zA-Z0-9]/g,"_")}_receipt.pdf`)};return r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-20"}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-30",children:e.jsxs("div",{className:"bg-gray-800 text-white rounded-lg shadow-lg p-6 w-full max-w-4xl mx-auto",children:[e.jsx("h2",{className:"text-xl mb-4",children:"Income Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-white block",children:"Work Date:"}),e.jsx("p",{className:"text-gray-300",children:new Date(r.workDate).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white block",children:"Customer Name:"}),e.jsx("p",{className:"text-gray-300",children:r.customerName})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white block",children:"Vehicle Number:"}),e.jsx("p",{className:"text-gray-300",children:r.vehicleNumber})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white block",children:"Contact Number:"}),e.jsx("p",{className:"text-gray-300",children:r.contactNumber})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white block",children:"Payment Method:"}),e.jsx("p",{className:"text-gray-300",children:r.paymentMethod})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white block",children:"Total Service Cost:"}),e.jsxs("p",{className:"text-gray-300",children:["₹ ",parseFloat(r.totalServiceCost).toLocaleString()]})]})]}),e.jsx("h3",{className:"text-lg mb-4",children:"Work Descriptions"}),e.jsxs("table",{className:"w-full mb-4",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center",children:"#"}),e.jsx("th",{className:"text-center",children:"Work Description"}),e.jsx("th",{className:"text-center",children:"Amount"}),e.jsx("th",{className:"text-center",children:"Reference"})]})}),e.jsx("tbody",{children:r.workDescriptions.map((n,l)=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-center",children:l+1}),e.jsx("td",{className:"text-center",children:n.description}),e.jsxs("td",{className:"text-center",children:["₹ ",parseFloat(n.amount).toLocaleString()]}),e.jsx("td",{className:"text-center",children:n.reference})]},l))})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{onClick:()=>N(),className:"bg-blue-600 text-white px-4 py-2 rounded",children:"Download PDF"}),e.jsx("button",{onClick:()=>m(),className:"bg-gray-600 text-white px-4 py-2 rounded",children:"Close"})]})]})})]}):null},se=({setIsModalOpen:r})=>{const[m,u]=i.useState(!1);return m?e.jsxs("button",{className:"cursor-pointer border border-cyan-600 bg-opacity-20 bg-cyan-600 text-white font-semibold py-2 px-3 rounded-lg shadow-md hover:bg-cyan-600 transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 flex",onMouseLeave:()=>u(!1),onClick:()=>r(!0),children:["Download",e.jsx("div",{className:`ml-2 w-6 h-6 transition-opacity duration-300 ${m?"opacity-100":"opacity-0"}`,children:e.jsx("img",{src:B,alt:"Download Icon"})})]}):e.jsx("button",{className:"cursor-pointer border border-cyan-600 bg-opacity-20 bg-cyan-600 text-white font-semibold py-2 px-3 rounded-lg shadow-md hover:bg-cyan-600 transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2",onMouseEnter:()=>u(!0),children:"Download"})};U.register(G,Q,K,Z,H,J);function ne({incomeHistoryData:r,setIsModalOpen:m}){const u=new Date,N=u.getMonth(),n=u.getFullYear(),[l,p]=i.useState("Monthly"),[c,x]=i.useState(n),[f,k]=i.useState(0),[v,I]=i.useState(0);i.useEffect(()=>{const o=r.reduce((a,t)=>{const s=t.totalServiceCost;return a+s},0);k(o),I((()=>{if(l==="Monthly")return r.reduce((a,t)=>{const s=new Date(t.workDate);return s.getMonth()===N&&s.getFullYear()===c?a+t.totalServiceCost:a},0);if(l==="Daily"){const a=new Date;return r.reduce((t,s)=>{const d=new Date(s.workDate),j=Math.floor((a-d)/(1e3*60*60*24));return j>=0&&j<7?t+s.totalServiceCost:t},0)}else if(l==="Yearly")return r.reduce((a,t)=>new Date(t.workDate).getFullYear()===c?a+t.totalServiceCost:a,0);return 0})())},[r,l,N,c]);const F=o=>{p(o.target.value),o.target.value!=="Monthly"&&x(new Date().getFullYear())},w=l==="Monthly"?(()=>{const o=Array(12).fill(0);return r.filter(a=>new Date(a.workDate).getFullYear()===c).forEach(a=>{const s=new Date(a.workDate).getMonth();o[s]+=a.totalServiceCost||0}),o.map((a,t)=>({name:new Date(0,t).toLocaleString("default",{month:"short"}),income:a}))})():l==="Daily"?(()=>{const o=new Date,g=Array(7).fill(0),a=[];for(let t=6;t>=0;t--){const s=new Date(o);s.setDate(o.getDate()-t);const d=s.toLocaleString("default",{weekday:"short"});a.push(d)}return r.forEach(t=>{const s=new Date(t.workDate),d=Math.floor((o-s)/(1e3*60*60*24));d>=0&&d<7&&(g[6-d]+=t.totalServiceCost||0)}),a.map((t,s)=>({name:t,income:g[s]}))})():(()=>{const o=Array(5).fill(0),g=[];for(let a=0;a<5;a++){const t=c-4+a;g.push(t)}return r.forEach(a=>{const s=new Date(a.workDate).getFullYear()-(c-4);s>=0&&s<5&&(o[s]+=a.totalServiceCost||0)}),g.map((a,t)=>({name:a,income:o[t]}))})(),h=w.map(o=>o.name),M=w.map(o=>o.income),D={labels:h,datasets:[{label:"Income",data:M,borderColor:"#00d8ff",backgroundColor:"rgba(0, 216, 255, 0.2)",tension:.3,fill:!0}]},P=()=>{c>new Date().getFullYear()-5&&x(o=>o-1)},y=()=>{c<new Date().getFullYear()&&x(o=>o+1)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"bg-gray-800 p-8 rounded-xl flex justify-between items-center mb-8",children:[e.jsxs("div",{className:"text-left space-y-3 w-1/3",children:[e.jsx("h2",{className:"text-5xl font-bold text-cyan-400",children:"Total income"}),e.jsx("h3",{className:"text-3xl text-green-300 font-bold",children:new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(f)}),e.jsx("p",{className:"text-gray-500",children:new Date().toLocaleDateString()}),e.jsxs("h2",{className:"text-3xl font-bold text-cyan-400",children:[l," income"]}),e.jsx("h3",{className:"text-3xl text-green-300 font-bold",children:new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(v)}),e.jsx(se,{setIsModalOpen:m})]}),e.jsxs("div",{className:"w-2/4 relative",children:[e.jsx("div",{className:"absolute z-10 bottom--4 left-0 p-2",children:e.jsx("div",{className:"bg-gray-700 px-1.5 py-1.5 rounded-full text-cyan-500",children:e.jsxs("select",{value:l,onChange:F,className:"cursor-pointer bg-gray-700 rounded-full text-cyan-500 outline-none",children:[e.jsx("option",{value:"Daily",children:"Daily"}),e.jsx("option",{value:"Monthly",children:"Monthly"}),e.jsx("option",{value:"Yearly",children:"Yearly"})]})})}),e.jsxs("div",{className:"mt-5",style:{width:"100%",height:"300px",marginBottom:"45px"},children:[e.jsx("div",{className:"flex justify-center mb-2 text-gray-300",children:l==="Daily"?e.jsx("span",{className:"text-lg font-semibold",children:"Last 7 Days"}):l==="Monthly"?e.jsx("span",{className:"text-lg font-semibold",children:c}):e.jsx("span",{className:"text-lg font-semibold",children:"Last 5 Years"})}),l==="Monthly"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute left-0 top-1/2 transform -translate-y-1/2 p-2 bg-gray-700 rounded-full text-cyan-400 hover:bg-gray-600 transition",style:{marginLeft:"-8%",width:"6%",height:"10%",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("button",{onClick:P,className:"text-cyan-400",children:e.jsx(A,{})})}),e.jsx("div",{className:"absolute right-0 top-1/2 transform -translate-y-1/2 p-2 bg-gray-700 rounded-full text-cyan-400 hover:bg-gray-600 transition",style:{marginRight:"1%",width:"6%",height:"10%",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("button",{onClick:y,className:"text-cyan-400",children:e.jsx(V,{})})})]}),e.jsx(X,{data:D,options:{responsive:!0,plugins:{legend:{display:!1},tooltip:{backgroundColor:"#333",titleColor:"#fff",bodyColor:"#fff"}},scales:{x:{grid:{display:!1},ticks:{color:"#999"}},y:{display:!1,grid:{display:!1}}}}})]})]})]})})}const re=({addIncomeModal:r})=>{const[m,u]=i.useState([]),[N,n]=i.useState(!1),[l,p]=i.useState({}),[c,x]=i.useState(1),[f,k]=i.useState(""),[v,I]=i.useState(null),[F,L]=i.useState(null),[Y,C]=i.useState(!1),w=5;i.useEffect(()=>{r||(async()=>{try{const s=(await R.showIncome()).data.sort((d,j)=>new Date(j.workDate)-new Date(d.workDate));u(s),console.log(s)}catch(t){console.error("Error fetching income history data",t)}})()},[r]);const h=()=>{let a=m;if(f){const t=f.toLowerCase();a=a.filter(s=>s.customerName.toLowerCase().includes(t)||s.contactNumber.toString().includes(t))}return a},M=(a,t)=>{const s=new z;s.setFontSize(12);const d=["Date","Customer Name","Vehicle Number","Phone Number","Amount"],j=m.filter(b=>{const S=new Date(b.workDate);return S>=a&&S<=t});s.text("Income History",100,10),d.forEach((b,S)=>s.text(b,14+S*40,25)),s.line(10,28,200,28);let E=0;j.forEach((b,S)=>{const W=[new Date(b.workDate).toLocaleDateString("en-GB"),b.customerName,b.vehicleNumber,b.contactNumber?b.contactNumber.toString():"",` ${b.totalServiceCost}`];E+=b.totalServiceCost,W.forEach((O,_)=>{s.text(O.toString(),14+_*40,35+S*10)})});const $=35+j.length*10;s.line(10,$,200,$),s.text(`Total Income:  ${E}`,150,$+10),s.save("income_history.pdf")},D=h(),P=D.length,y=Math.ceil(P/w),o=D.slice((c-1)*w,c*w),g=a=>{p(a),n(!0)};return e.jsxs("div",{className:"min-h-screen bg-gray-900 p-10 text-gray-100 relative",children:[e.jsxs("main",{className:"mt-8 p-2",children:[e.jsx(ne,{incomeHistoryData:m,setIsModalOpen:C}),e.jsxs("div",{className:"bg-gray-800 p-10 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-2xl font-bold text-cyan-400",children:"Income History"}),e.jsx("input",{type:"text",value:f,onChange:a=>k(a.target.value),placeholder:"Search by name or phone",className:"bg-gray-700 text-gray-100 px-4 py-2 rounded-lg"})]}),e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-gray-500",children:[e.jsx("th",{className:"pb-2",children:"Date"}),e.jsx("th",{className:"pb-2",children:"Customer name"}),e.jsx("th",{className:"pb-2",children:"Vehicle number"}),e.jsx("th",{className:"pb-2",children:"Payment type"}),e.jsx("th",{className:"pb-2",children:"Phone number"}),e.jsx("th",{className:"pb-2",children:"Amount"}),e.jsx("th",{className:"pb-2",children:"Receipt"})]})}),e.jsx("tbody",{children:o.length>0?o.map(a=>e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("td",{className:"py-2",children:new Date(a.workDate).toLocaleDateString("en-GB")}),e.jsx("td",{className:"py-2",children:a.customerName}),e.jsx("td",{className:"py-2",children:a.vehicleNumber}),e.jsx("td",{className:"py-2",children:a.paymentMethod}),e.jsx("td",{className:"py-2",children:a.contactNumber}),e.jsxs("td",{className:"py-2",children:["₹ ",a.totalServiceCost]}),e.jsx("td",{className:"py-2",children:e.jsx("button",{onClick:()=>g(a),className:"text-cyan-400",children:"View"})})]},a.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"py-4 text-center text-gray-500",children:"No data available"})})})]}),y>1&&e.jsxs("div",{className:"flex justify-between mt-4",children:[e.jsx("button",{onClick:()=>x(a=>Math.max(a-1,1)),disabled:c===1,className:`text-cyan-400 ${c===1?"opacity-50 cursor-not-allowed":""}`,children:e.jsx(A,{})}),e.jsxs("span",{className:"text-gray-300",children:["Page ",c," of ",y]}),e.jsx("button",{onClick:()=>x(a=>Math.min(a+1,y)),disabled:c===y,className:`text-cyan-400 ${c===y?"opacity-50 cursor-not-allowed":""}`,children:e.jsx(V,{})})]}),N&&e.jsx(ae,{entry:l,onClose:()=>n(!1)})]})]}),e.jsx(ee,{isOpen:Y,onClose:()=>C(!1),customStartDate:v,setCustomStartDate:I,customEndDate:F,setCustomEndDate:L,generatePDF:M})]})},le=({setAddIncomeModal:r})=>{const[m,u]=i.useState([{description:"",amount:"",reference:""}]),[N,n]=i.useState(""),[l,p]=i.useState(""),[c,x]=i.useState(""),[f,k]=i.useState(""),[v,I]=i.useState(""),F=new Date,L={timeZone:"Asia/Kolkata"},Y=F.toLocaleDateString("en-CA",L),[C,w]=i.useState(Y),[h,M]=i.useState({}),D=(t,s)=>{const{name:d,value:j}=s.target,E=[...m];E[t][d]=j,u(E)},P=()=>{u([...m,{description:"",amount:"",reference:""}])},y=t=>{const s=m.filter((d,j)=>j!==t);u(s)},o=()=>m.reduce((t,s)=>{const d=parseFloat(s.amount)||0;return t+d},0),g=()=>{let t={};return C||(t.workDate="Work date is required."),N||(t.customerName="Customer name is required."),l||(t.vehicleNumber="Vehicle number is required."),c||(t.contactNumber="Contact number is required."),f||(t.paymentMethod="Select a payment method."),v||(t.totalServiceCost="Total cost is required."),M(t),Object.keys(t).length===0},a=async()=>{if(!g())return;const t={workDate:C,customerName:N,vehicleNumber:l.toUpperCase(),contactNumber:c,paymentMethod:f,totalServiceCost:v,workDescriptions:m};try{const s=await R.addIncome(t);if(s.error){T("Error!",s.errors[0],"error");return}T("Success!","income added successfully!","success"),r(!1)}catch(s){console.error(s),T("Error!","Failed to add income.","error")}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-20"}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-30",children:e.jsxs("div",{className:"bg-gray-800 text-white rounded-lg shadow-lg p-6 w-full max-w-4xl mx-auto",children:[e.jsx("h2",{className:"text-xl mb-4",children:"Income Entry"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-white",children:"Work Date"}),e.jsx("input",{type:"date",className:"p-2 bg-gray-700 rounded w-full",value:C,onChange:t=>w(t.target.value)}),h.workDate&&e.jsx("p",{className:"text-red-500",children:h.workDate})]}),e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-white",children:"Customer Name"}),e.jsx("input",{type:"text",placeholder:"Who is the customer?",className:"p-2 bg-gray-700 rounded w-full",value:N,onChange:t=>n(t.target.value)}),h.customerName&&e.jsx("p",{className:"text-red-500",children:h.customerName})]}),e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-white",children:"Vehicle Number"}),e.jsx("input",{type:"text",placeholder:"Plate ID for this vehicle?",className:"p-2 bg-gray-700 rounded w-full",value:l.toUpperCase(),onChange:t=>p(t.target.value)}),h.vehicleNumber&&e.jsx("p",{className:"text-red-500",children:h.vehicleNumber})]}),e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-white",children:"Contact Number"}),e.jsx("input",{type:"tel",placeholder:"Preferred contact for updates?",className:"p-2 bg-gray-700 rounded w-full",value:c,onChange:t=>x(t.target.value)}),h.contactNumber&&e.jsx("p",{className:"text-red-500",children:h.contactNumber})]}),e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-white",children:"Payment Method"}),e.jsxs("select",{className:"p-2 bg-gray-700 rounded w-full",value:f,onChange:t=>k(t.target.value),children:[e.jsx("option",{value:"",children:"How did you pay?"}),e.jsx("option",{value:"Cash",children:"Cash"}),e.jsx("option",{value:"UPI",children:"UPI"}),e.jsx("option",{value:"Online Transfer",children:"Online Transfer"})]}),h.paymentMethod&&e.jsx("p",{className:"text-red-500",children:h.paymentMethod})]}),e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-white",children:"Total Service Cost"}),e.jsx("input",{type:"number",placeholder:"Total service cost?",className:"p-2 bg-gray-700 rounded w-full",value:v,onChange:t=>I(t.target.value)}),h.totalServiceCost&&e.jsx("p",{className:"text-red-500",children:h.totalServiceCost})]})]}),e.jsxs("table",{className:"w-full mb-4",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Work Description"}),e.jsx("th",{children:"Amount"}),e.jsx("th",{children:"Reference"}),e.jsx("th",{children:"Action"})]})}),e.jsx("tbody",{children:m.map((t,s)=>e.jsxs("tr",{children:[e.jsx("td",{children:s+1}),e.jsx("td",{children:e.jsx("input",{type:"text",name:"description",value:t.description,onChange:d=>D(s,d),className:"p-2 bg-gray-700 rounded w-full",placeholder:"Name of the work"})}),e.jsx("td",{children:e.jsx("input",{type:"number",name:"amount",value:t.amount,onChange:d=>D(s,d),className:"p-2 bg-gray-700 rounded w-full",placeholder:"Amount of work"})}),e.jsx("td",{children:e.jsx("input",{type:"text",name:"reference",value:t.reference,onChange:d=>D(s,d),className:"p-2 bg-gray-700 rounded w-full",placeholder:"Additional information"})}),e.jsx("td",{children:e.jsx("button",{className:"text-red-500",onClick:()=>y(s),children:"🗑"})})]},s))})]}),e.jsx("button",{onClick:P,className:"bg-teal-500 text-white px-4 py-2 rounded mb-4",children:"+ Add Field"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-lg font-semibold",children:["Total Amount: ₹ ",o().toLocaleString()]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{onClick:()=>r(!1),className:"bg-gray-600 text-white px-4 py-2 rounded",children:"Cancel"}),e.jsx("button",{onClick:a,className:"bg-teal-500 text-white px-4 py-2 rounded",children:"Save"})]})]})]})})]})},he=()=>{const[r,m]=i.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(te,{setAddIncomeModal:m}),e.jsx(re,{addIncomeModal:r}),r&&e.jsx(le,{setAddIncomeModal:m})]})};export{he as default};
